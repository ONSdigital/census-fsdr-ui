{% extends 'base.html' %}

{% from "components/content-pagination/_macro.njk" import onsContentPagination %}
{% from 'components/lists/_macro.njk' import onsList %}
{% from 'components/input/_macro.njk' import onsInput %}
{% from "custom/pagination/_macro.njk" import onsPagination %}
{% from 'components/panel/_macro.njk' import onsPanel %}
{% from "components/table/_macro.njk" import onsTable %}
{% set page_title_value = page_title %}
{% set index_url = "/search+" %}

{% block pageContent %}
    {% block main %}
        <div class="grid">
            <div class="grid__col col-2@m"></div>
            <div class="grid__col col-8@m">
                <div style="overflow-x: auto; width: 100%">
                    <br>
                    <h1>{{ page_title_value }}</h1>
                    {% if called_from_index == 'false' %}
                        {{ onsButton({
                            'text': 'Back to Search',
                            'classes': 'btn--small',
                            'submitType': "loader",
                            'url': '/search'
                        }) }}
                        <br>
                    {% else %}
                        <form class="form-inline" id="user_filter" action="/search+{{ page_number }}+true+default+default" method="post">
                            <table>
                                <label class="label" for="text">Filter on field workers</label>
                                <tr>
                                    <th>
                                        <label class="label" for="select" style="text-align: left">Job Role ID</label>
                                        <select id="user_select" name="job_role_select" class="input input--select ">
                                          {% if previous_jobrole_selected %}
                                            {% set check_drop_value = previous_select %}
                                            <option value="{{ previous_jobrole_selected }}" selected="selected">
                                                {{ previous_jobrole_selected }}
                                            </option>
                                            <option value="" disabled>
                                                Select an option
                                            </option>
                                            {% for job_role in distinct_job_roles %}
                                                {% if job_role == previous_jobrole_selected %}
                                                {% else %}
                                                  <option value="{{ job_role }}" name="{{ job_role }}">
                                                    {{ job_role }}
                                                  </option>
                                                {% endif %}
                                            {% endfor %}
                                          {% else %}
                                            <option value="" selected disabled>
                                                Select an option
                                            </option>
                                            {% for job_role in distinct_job_roles %}
                                              <option value="{{ job_role }}" name="{{ job_role }}">
                                              {{ job_role }}
                                              </option>
                                            {% endfor %}
                                          {% endif %}
                                          </select>
                                    </th>
                                    <td>
                                        <label class="label" for="text" style="text-align: left">Worker Surname</label>
                                        <input id="user_select" name="filter_surname" class="input input--text input-type__input" value="{{ previous_surname_filter}}">
                                    </td>
                                    <td>
                                        <label class="label" for="text" style="text-align: left">Area</label>
                                        <input id="user_select" name="filter_area" class="input input--text input-type__input" value="{{ previous_area }}">
                                    </td>
                                </tr>
                            </table>
                            <br>
                            {{ onsButton({
                                'text': 'Filter',
                                'classes': 'btn--small',
                                'submitType': "loader",
                                'name': 'action[submit]'
                            }) }}
                            {{ onsButton({
                                'text': 'Clear',
                                'classes': 'btn--small',
                                'submitType': "loader",
                                'url': '/index+1'
                            }) }}
                        </form>
                    {% endif %}
                    {% if no_employee_data == 'true' %}
                        <br>
                        {% call onsPanel({
                            "title": "No employee data",
                            "titleTag": "h1",
                            "type": "error"
                            }) %}
                            <p>No employee records have been found</p>
                        {% endcall %}
                    {% else %}
                        <table class="table  table--sortable  table-scrollable--on" data-aria-sort="Sort by"
                               data-aria-asc="ascending" data-aria-desc="descending">
                            <caption class="table__caption"><br>Field Workers</caption>
                            <thead class="table__head">
                            <tr class="table__row">
                                <th scope="col" class="table__header " aria-sort="none">ID</th>
                                <th scope="col" class="table__header " aria-sort="none">Name</th>
                                <th scope="col" class="table__header " aria-sort="none">Job Role ID</th>
                                <th scope="col" class="table__header " aria-sort="none">Job Role</th>
                                <th scope="col" class="table__header " aria-sort="none">Area</th>
                                <th scope="col" class="table__header " aria-sort="none">Asgmt. Status</th>
                                <th scope="col" class="table__header " aria-sort="none">Emp. Details</th>
                            </tr>
                            </thead>
                            <tbody class="table__body">
                            {% for employee in employee_records %}
                                <tr class="table__row" style="text-align: center">
                                    <td class="table__cell ">
                                        {{ employee.unique_employee_id }}
                                    </td>
                                    <td class="table__cell ">
                                        {{ employee.first_name + " " + employee.surname }}
                                    </td>
                                    <td class="table__cell ">
                                        {{ employee.unique_role_id }}
                                    </td>
                                    <td class="table__cell ">
                                        {{ employee.job_role }}
                                    </td>
                                    <td class="table__cell ">
                                        {{ employee.area_location }}
                                    </td>
                                    <td class="table__cell ">
                                        {{ employee.assignment_status }}
                                    </td>
                                    <td class="table__cell ">
                                        <a href="/employeeinformation/{{ employee.unique_employee_id }}">View Field Worker</a>
                                    </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>

                        {% if last_page_number|float or last_page_number|int == 0 %}
                            {%  set last_page = (last_page_number|int + 1) %}
                        {% else %}
                            {% set last_page = last_page_number|int %}
                        {% endif %}

                        {% set count = [0] %}

                        {% set pagination_array = [] %}

                        {% for x in range(last_page|int) %}
                            {% if x == page_number %}
                                {% set set_url = index_url + x|string %}
                                {% set pagination_array = pagination_array.append({"url": set_url + '+' + called_from_index + "+"  + previous_selection + '+' + last_page|string , "current": True}) %}
                            {% else %}
                                {% set set_url = index_url + x|string %}
                                {% set pagination_array = pagination_array.append({"url": set_url + '+' + called_from_index + "+" + previous_selection + '+' + last_page|string, "current": False}) %}
                            {% endif %}
                            {% set count = count.append(count.pop() + 1) %}
                        {% endfor %}

                        <div class="page_numbering" align="center">
                            {{
                                onsPagination({
                                    "previous": "Previous",
                                    "next": "Next",
                                    "pages": pagination_array
                                })
                            }}
                        </div>
                {% endif %}
                </div>
            </div>
            <div class="grid__col col-2@m"></div>
        </div>
    {% endblock %}
{% endblock %}